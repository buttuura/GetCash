<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  <title>üëë Admin Dashboard - GetCash</title>
  <link rel="stylesheet" href="getcash.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .admin-header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 100px;
    }
    
    .admin-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .admin-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }
    
    .admin-card h3 {
      color: white;
      font-size: 1.5em;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .admin-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .admin-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }
    
    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
    }
    
    .admin-btn.secondary {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
    }
    
    .admin-btn.secondary:hover {
      box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
    }
    
    .admin-btn.tertiary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .admin-btn.tertiary:hover {
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .stats-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      color: white;
      text-align: center;
    }
    
    .stats-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    
    .admin-form {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 15px;
      margin-top: 20px;
    }
    
    .admin-form label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    
    .admin-form input, .admin-form textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    
    .admin-form input:focus, .admin-form textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .task-preview {
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin: 15px 0;
    }
    
    .task-preview img {
      max-width: 150px;
      max-height: 150px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    .task-preview div {
      color: white;
      font-weight: bold;
      margin: 5px 0;
    }
    
    @media (max-width: 768px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-header h1 {
        font-size: 2em;
      }
      
      .admin-form input, .admin-form textarea {
        font-size: 16px; /* Prevents zoom on iOS */
      }
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">üö™ Logout</button>
  
  <div class="admin-header">
    <h1>üëë Admin Dashboard</h1>
    <p>Welcome, Admin! Manage your GetCash platform</p>
  </div>

  <div class="admin-container">
    <!-- Stats Overview -->
    <div class="stats-card">
      <div class="stats-number" id="totalUsers">0</div>
      <div>Total Users</div>
    </div>

    <div class="admin-grid">
      <!-- User Management Card -->
      <div class="admin-card">
        <h3>üë• User Management</h3>
        <div class="admin-buttons">
          <a href="admin-users.html" class="admin-btn">View All Users</a>
          <a href="admin-setup.html" class="admin-btn secondary">Admin Setup</a>
          <button class="admin-btn tertiary" onclick="exportUsers()">Export User Data</button>
        </div>
      </div>

      <!-- Page Navigation Card -->
      <div class="admin-card">
        <h3>üìÑ Page Management</h3>
        <div class="admin-buttons">
          <a href="getcash.html" class="admin-btn">Main GetCash Page</a>
          <a href="task-list.html" class="admin-btn secondary">Task List</a>
          <a href="wallet-interface.html" class="admin-btn tertiary">Wallet Interface</a>
          <a href="recharge.html" class="admin-btn">Recharge Page</a>
        </div>
      </div>

      <!-- Quick Actions Card -->
      <div class="admin-card">
        <h3>‚ö° Quick Actions</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="createTestUser()">Create Test User</button>
          <button class="admin-btn secondary" onclick="clearAllData()">Clear All Data</button>
          <button class="admin-btn tertiary" onclick="backupData()">Backup Data</button>
          <button class="admin-btn" onclick="restoreData()">Restore Data</button>
        </div>
      </div>

      <!-- System Tools Card -->
      <div class="admin-card">
        <h3>üîß System Tools</h3>
        <div class="admin-buttons">
          <a href="test-redirect.html" class="admin-btn">Test Redirect</a>
          <button class="admin-btn secondary" onclick="checkSystem()">System Check</button>
          <button class="admin-btn tertiary" onclick="generateReport()">Generate Report</button>
        </div>
      </div>

      <!-- App Pages Card -->
      <div class="admin-card">
        <h3>üéØ All App Pages</h3>
        <div class="admin-buttons">
          <a href="login-page.html" class="admin-btn">Login Page</a>
          <a href="registration.html" class="admin-btn secondary">Registration Page</a>
          <a href="jobs.html" class="admin-btn tertiary">Jobs Page</a>
          <a href="withdraw.html" class="admin-btn">Withdraw Page</a>
        </div>
      </div>

      <!-- Settings Card -->
      <div class="admin-card">
        <h3>‚öôÔ∏è Settings</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="updateSettings()">App Settings</button>
          <button class="admin-btn secondary" onclick="manageNotifications()">Notifications</button>
          <button class="admin-btn tertiary" onclick="securitySettings()">Security</button>
        </div>
      </div>
    </div>

    <!-- Task Upload Section -->
    <div class="admin-card" style="max-width: 600px; margin: 30px auto;">
      <h3>üì§ Upload New Task</h3>
      <form id="adminTaskForm" class="admin-form">
        <label for="taskTitle">Task Title:</label>
        <input type="text" id="taskTitle" name="taskTitle" placeholder="Enter task title" required>
        
        <label for="taskPrice">Task Price (UGX):</label>
        <input type="number" id="taskPrice" name="taskPrice" placeholder="Enter price" step="0.01" required>
        
        <label for="taskDescription">Task Description:</label>
        <textarea id="taskDescription" name="taskDescription" placeholder="Enter task description" rows="3"></textarea>
        
        <label for="taskImage">Task Image:</label>
        <input type="file" id="taskImage" name="taskImage" accept="image/*" required>
        
        <div id="taskPreview" class="task-preview" style="display: none;"></div>
        
        <button type="submit" class="admin-btn" style="margin-top: 20px;">üì§ Upload Task</button>
        <button type="button" class="admin-btn" id="cancelEditBtn" onclick="cancelEdit()" style="margin-top: 10px; background: linear-gradient(45deg, #ff6b35, #f7931e); display: none;">‚ùå Cancel Edit</button>
        <button type="button" class="admin-btn secondary" onclick="viewUploadedTasks()" style="margin-top: 10px;">üëÄ View Uploaded Tasks</button>
      </form>
    </div>
    
    <!-- Uploaded Tasks Display -->
    <div id="uploadedTasksSection" class="admin-card" style="max-width: 800px; margin: 20px auto; display: none;">
      <h3>üìã Uploaded Tasks</h3>
      <div id="uploadedTasksList"></div>
    </div>
  </div>

  <!-- Include Scripts -->
  <script src="mobile-compatibility.js"></script>
  <script src="client-storage.js"></script>
  <script src="notifications.js"></script>
  <script src="storage-manager.js"></script>
  <script src="demo-mode.js"></script>

  <script>
    const clientStorage = new ClientStorage();
    
    // Load user stats
    document.addEventListener('DOMContentLoaded', function() {
      loadStats();
      
      // Check if user is admin
      const isAdmin = localStorage.getItem('isAdmin') === 'true' || localStorage.getItem('username') === '0776944';
      if (!isAdmin) {
        alert('Access denied! Admin privileges required.');
        window.location.href = 'getcash.html';
        return;
      }
      
      if (typeof showNotification === 'function') {
        showNotification('üëë Welcome to Admin Dashboard!', 'success');
      }
    });
    
    function loadStats() {
      try {
        const users = clientStorage.getAllUsers();
        document.getElementById('totalUsers').textContent = users.length;
      } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('totalUsers').textContent = '0';
      }
    }
    
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('isAdmin');
        localStorage.removeItem('username');
        localStorage.removeItem('userId');
        sessionStorage.clear();
        if (typeof showNotification === 'function') {
          showNotification('üëã Logged out successfully!', 'info');
        }
        setTimeout(() => {
          window.location.href = 'login-page.html';
        }, 1500);
      }
    }
    
    function createTestUser() {
      const testUser = {
        username: 'testuser' + Date.now(),
        password: 'test123',
        phone: '123456789'
      };
      
      clientStorage.register(testUser).then(result => {
        if (result.success) {
          if (typeof showNotification === 'function') {
            showNotification('‚úÖ Test user created: ' + testUser.username, 'success');
          }
          loadStats();
        } else {
          if (typeof showNotification === 'function') {
            showNotification('‚ùå Error: ' + result.message, 'error');
          }
        }
      });
    }
    
    function clearAllData() {
      if (confirm('‚ö†Ô∏è This will delete ALL user data! Are you sure?')) {
        localStorage.removeItem('getcash_data');
        clientStorage.init();
        if (typeof showNotification === 'function') {
          showNotification('üóëÔ∏è All data cleared!', 'warning');
        }
        loadStats();
      }
    }
    
    function exportUsers() {
      const users = clientStorage.getAllUsers();
      const dataStr = JSON.stringify(users, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-users-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      if (typeof showNotification === 'function') {
        showNotification('üìÅ User data exported!', 'success');
      }
    }
    
    function backupData() {
      const allData = clientStorage.getData();
      const dataStr = JSON.stringify(allData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-backup-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      if (typeof showNotification === 'function') {
        showNotification('üíæ Full backup created!', 'success');
      }
    }
    
    function restoreData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            clientStorage.saveData(data);
            if (typeof showNotification === 'function') {
              showNotification('üîÑ Data restored successfully!', 'success');
            }
            loadStats();
          } catch (error) {
            if (typeof showNotification === 'function') {
              showNotification('‚ùå Invalid backup file!', 'error');
            }
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    function checkSystem() {
      const checks = [
        'Client Storage: ' + (typeof ClientStorage !== 'undefined' ? '‚úÖ' : '‚ùå'),
        'Notifications: ' + (typeof showNotification === 'function' ? '‚úÖ' : '‚ùå'),
        'Mobile Support: ' + (typeof window.universalRedirect === 'function' ? '‚úÖ' : '‚ùå'),
        'Local Storage: ' + (localStorage.getItem('getcash_data') ? '‚úÖ' : '‚ùå')
      ];
      
      alert('System Status:\n\n' + checks.join('\n'));
    }
    
    function generateReport() {
      const users = clientStorage.getAllUsers();
      const report = {
        generated: new Date().toISOString(),
        totalUsers: users.length,
        adminUsers: users.filter(u => {
          const data = clientStorage.getData();
          const fullUser = data.users.find(fu => fu.id === u.id);
          return fullUser && (fullUser.isAdmin || fullUser.username === '0776944');
        }).length,
        totalBalance: users.reduce((sum, u) => sum + u.balance, 0),
        recentUsers: users.filter(u => {
          const joinDate = new Date(u.joinDate);
          const weekAgo = new Date();
          weekAgo.setDate(weekAgo.getDate() - 7);
          return joinDate > weekAgo;
        }).length
      };
      
      const reportStr = `GetCash Admin Report
Generated: ${report.generated}

üìä Statistics:
- Total Users: ${report.totalUsers}
- Admin Users: ${report.adminUsers}
- Total Balance: $${report.totalBalance}
- New Users (7 days): ${report.recentUsers}
`;
      
      const dataBlob = new Blob([reportStr], {type: 'text/plain'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-report-' + new Date().toISOString().split('T')[0] + '.txt';
      link.click();
      
      if (typeof showNotification === 'function') {
        showNotification('üìà Report generated!', 'success');
      }
    }
    
    function updateSettings() {
      if (typeof showNotification === 'function') {
        showNotification('‚öôÔ∏è Settings feature coming soon!', 'info');
      }
    }
    
    function manageNotifications() {
      if (typeof showNotification === 'function') {
        showNotification('üîî Notification management coming soon!', 'info');
      }
    }
    
    function securitySettings() {
      if (typeof showNotification === 'function') {
        showNotification('üîí Security settings coming soon!', 'info');
      }
    }
    
    // Task Upload Functionality
    document.getElementById('taskImage').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('taskPreview');
      const title = document.getElementById('taskTitle').value;
      const price = document.getElementById('taskPrice').value;
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          preview.innerHTML = `
            <img src="${evt.target.result}" alt="Preview">
            <div>${title || 'Task Title'}</div>
            <div>UGX ${price || '0'}</div>
          `;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = '';
        preview.style.display = 'none';
      }
    });
    
    // Update preview when title or price changes
    document.getElementById('taskTitle').addEventListener('input', updatePreview);
    document.getElementById('taskPrice').addEventListener('input', updatePreview);
    
    function updatePreview() {
      const file = document.getElementById('taskImage').files[0];
      if (file) {
        document.getElementById('taskImage').dispatchEvent(new Event('change'));
      }
    }
    
    // Handle form submission
    document.getElementById('adminTaskForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const title = document.getElementById('taskTitle').value;
      const price = document.getElementById('taskPrice').value;
      const description = document.getElementById('taskDescription').value;
      const imageInput = document.getElementById('taskImage');
      const file = imageInput.files[0];
      const editingId = this.dataset.editingId;
      
      // For editing, image is optional (keep existing if no new image)
      if (!file && !editingId) {
        if (typeof showNotification === 'function') {
          showNotification('‚ùå Please select an image file!', 'error');
        }
        return;
      }
      
      const processTask = (imageData = null) => {
        try {
          const data = clientStorage.getData();
          if (!data.tasks) data.tasks = [];
          
          if (editingId) {
            // Update existing task
            const taskIndex = data.tasks.findIndex(t => t.id == editingId);
            if (taskIndex !== -1) {
              data.tasks[taskIndex] = {
                ...data.tasks[taskIndex],
                title: title,
                description: description,
                price: parseFloat(price),
                ...(imageData && { image: imageData }),
                updatedAt: new Date().toISOString()
              };
              
              if (typeof showNotification === 'function') {
                showNotification(`‚úÖ Task "${title}" updated successfully!`, 'success');
              }
            }
          } else {
            // Create new task
            const taskData = {
              id: Date.now(),
              title: title,
              description: description,
              price: parseFloat(price),
              image: imageData,
              status: 'available',
              category: 'admin',
              createdAt: new Date().toISOString()
            };
            data.tasks.push(taskData);
            
            if (typeof showNotification === 'function') {
              showNotification(`‚úÖ Task "${title}" uploaded successfully!`, 'success');
            }
          }
          
          clientStorage.saveData(data);
          
          // Reset form
          document.getElementById('adminTaskForm').reset();
          document.getElementById('taskPreview').style.display = 'none';
          delete this.dataset.editingId;
          
          // Reset buttons
          const submitBtn = document.querySelector('#adminTaskForm button[type="submit"]');
          submitBtn.innerHTML = 'üì§ Upload Task';
          document.getElementById('cancelEditBtn').style.display = 'none';
          
          // Refresh task list if visible
          if (document.getElementById('uploadedTasksSection').style.display !== 'none') {
            viewUploadedTasks();
          }
          
        } catch (error) {
          console.error('Task processing error:', error);
          if (typeof showNotification === 'function') {
            showNotification('‚ùå Failed to process task: ' + error.message, 'error');
          }
        }
      };
      
      if (file) {
        if (typeof showNotification === 'function') {
          showNotification(editingId ? 'üìù Updating task...' : 'üì§ Uploading task...', 'info', 2000);
        }
        
        const reader = new FileReader();
        reader.onload = function(evt) {
          processTask(evt.target.result);
        };
        reader.readAsDataURL(file);
      } else {
        // For editing without new image
        if (typeof showNotification === 'function') {
          showNotification('üìù Updating task...', 'info', 2000);
        }
        processTask();
      }
    });
    
    // Task Management Functions
    function viewUploadedTasks() {
      const tasksSection = document.getElementById('uploadedTasksSection');
      const tasksList = document.getElementById('uploadedTasksList');
      
      // Get tasks from client storage
      const data = clientStorage.getData();
      const tasks = data.tasks || [];
      
      if (tasks.length === 0) {
        tasksList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">üì≠ No tasks uploaded yet.</p>';
      } else {
        tasksList.innerHTML = tasks.map(task => `
          <div class="task-item" style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px);">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
              <h4 style="margin: 0; color: #fff; flex: 1;">${task.title}</h4>
              <span style="background: ${task.status === 'available' ? 'linear-gradient(45deg, #00ff41, #00d935)' : 'linear-gradient(45deg, #ff6b35, #f7931e)'}; color: white; padding: 4px 8px; border-radius: 15px; font-size: 12px; margin-left: 10px;">
                ${task.status === 'available' ? '‚úÖ Active' : '‚è∏Ô∏è Inactive'}
              </span>
            </div>
            <p style="color: #00ff41; font-weight: bold; margin: 5px 0; font-size: 18px;">üí∞ UGX ${task.price}</p>
            <p style="color: #ccc; margin: 10px 0; line-height: 1.4;">${task.description}</p>
            ${task.image ? `
              <div style="margin: 10px 0;">
                <img src="${task.image}" alt="Task Image" style="max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: cover;">
              </div>
            ` : ''}
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 10px;">
              <span style="color: #999; font-size: 12px;">üìÖ ${new Date(task.createdAt).toLocaleString()}</span>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="toggleTaskStatus(${task.id})" style="background: linear-gradient(45deg, #3742fa, #5352ed); color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                  ${task.status === 'available' ? '‚è∏Ô∏è Deactivate' : '‚úÖ Activate'}
                </button>
                <button onclick="editTask(${task.id})" style="background: linear-gradient(45deg, #ff9ff3, #f368e0); color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                  ‚úèÔ∏è Edit
                </button>
                <button onclick="deleteTask(${task.id})" style="background: linear-gradient(45deg, #ff4757, #ff6b81); color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                  üóëÔ∏è Delete
                </button>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      // Toggle visibility
      if (tasksSection.style.display === 'none' || tasksSection.style.display === '') {
        tasksSection.style.display = 'block';
        tasksSection.scrollIntoView({ behavior: 'smooth' });
        document.querySelector('button[onclick="viewUploadedTasks()"]').textContent = 'üôà Hide Tasks';
      } else {
        tasksSection.style.display = 'none';
        document.querySelector('button[onclick="viewUploadedTasks()"]').textContent = 'üëÄ View Uploaded Tasks';
      }
    }
    
    function toggleTaskStatus(taskId) {
      const data = clientStorage.getData();
      const task = data.tasks.find(t => t.id === taskId);
      
      if (task) {
        task.status = task.status === 'available' ? 'inactive' : 'available';
        clientStorage.saveData(data);
        
        if (typeof showNotification === 'function') {
          showNotification(`‚úÖ Task "${task.title}" ${task.status === 'available' ? 'activated' : 'deactivated'}!`, 'success');
        }
        
        viewUploadedTasks(); // Refresh the list
      }
    }
    
    function editTask(taskId) {
      const data = clientStorage.getData();
      const task = data.tasks.find(t => t.id === taskId);
      
      if (task) {
        // Pre-fill the form with task data
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskPrice').value = task.price;
        document.getElementById('taskDescription').value = task.description;
        
        // Scroll to form
        document.querySelector('.admin-card:has(#adminTaskForm)').scrollIntoView({ behavior: 'smooth' });
        
        // Store the task ID for updating instead of creating new
        document.getElementById('adminTaskForm').dataset.editingId = taskId;
        
        // Change submit button text and show cancel button
        const submitBtn = document.querySelector('#adminTaskForm button[type="submit"]');
        submitBtn.innerHTML = '‚úèÔ∏è Update Task';
        document.getElementById('cancelEditBtn').style.display = 'inline-block';
        
        if (typeof showNotification === 'function') {
          showNotification(`‚úèÔ∏è Editing task: ${task.title}`, 'info');
        }
      }
    }
    
    function cancelEdit() {
      // Reset form
      document.getElementById('adminTaskForm').reset();
      document.getElementById('taskPreview').style.display = 'none';
      delete document.getElementById('adminTaskForm').dataset.editingId;
      
      // Reset buttons
      const submitBtn = document.querySelector('#adminTaskForm button[type="submit"]');
      submitBtn.innerHTML = 'üì§ Upload Task';
      document.getElementById('cancelEditBtn').style.display = 'none';
      
      if (typeof showNotification === 'function') {
        showNotification('‚ùå Edit cancelled', 'info');
      }
    }
    
    function deleteTask(taskId) {
      const data = clientStorage.getData();
      const task = data.tasks.find(t => t.id === taskId);
      
      if (task && confirm(`üóëÔ∏è Are you sure you want to delete "${task.title}"?\n\nThis action cannot be undone.`)) {
        data.tasks = data.tasks.filter(t => t.id !== taskId);
        clientStorage.saveData(data);
        
        if (typeof showNotification === 'function') {
          showNotification(`üóëÔ∏è Task "${task.title}" deleted successfully!`, 'warning');
        }
        
        viewUploadedTasks(); // Refresh the list
      }
    }
  </script>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-icon" onclick="location.href='getcash.html'">
      <img src="image/icon/index.png" alt="Home">
      <span>Home</span>
    </div>
    <div class="footer-icon footer-active">
      <img src="image/icon/user.png" alt="Admin">
      <span>Admin</span>
    </div>
    <div class="footer-icon" onclick="location.href='admin-users.html'">
      <img src="image/icon/grab.png" alt="Users">
      <span>Users</span>
    </div>
    <div class="footer-icon" onclick="logout()">
      <img src="image/icon/profit.png" alt="Logout">
      <span>Logout</span>
    </div>
  </footer>
</body>
</html>