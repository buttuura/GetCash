<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  <title>üëë Admin Dashboard - GetCash</title>
  <link rel="stylesheet" href="getcash.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .admin-header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 100px;
    }
    
    .admin-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .admin-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }
    
    .admin-card h3 {
      color: white;
      font-size: 1.5em;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .admin-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .admin-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }
    
    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
    }
    
    .admin-btn.secondary {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
    }
    
    .admin-btn.secondary:hover {
      box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
    }
    
    .admin-btn.tertiary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .admin-btn.tertiary:hover {
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .stats-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      color: white;
      text-align: center;
    }
    
    .stats-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    
    @media (max-width: 768px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-header h1 {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">üö™ Logout</button>
  
  <div class="admin-header">
    <h1>üëë Admin Dashboard</h1>
    <p>Welcome, Admin! Manage your GetCash platform</p>
  </div>

  <div class="admin-container">
    <!-- Stats Overview -->
    <div class="stats-card">
      <div class="stats-number" id="totalUsers">0</div>
      <div>Total Users</div>
    </div>

    <div class="admin-grid">
      <!-- User Management Card -->
      <div class="admin-card">
        <h3>üë• User Management</h3>
        <div class="admin-buttons">
          <a href="admin-users.html" class="admin-btn">View All Users</a>
          <a href="admin-setup.html" class="admin-btn secondary">Admin Setup</a>
          <button class="admin-btn tertiary" onclick="exportUsers()">Export User Data</button>
        </div>
      </div>

      <!-- Page Navigation Card -->
      <div class="admin-card">
        <h3>üìÑ Page Management</h3>
        <div class="admin-buttons">
          <a href="getcash.html" class="admin-btn">Main GetCash Page</a>
          <a href="task-list.html" class="admin-btn secondary">Task List</a>
          <a href="wallet-interface.html" class="admin-btn tertiary">Wallet Interface</a>
          <a href="recharge.html" class="admin-btn">Recharge Page</a>
        </div>
      </div>

      <!-- Quick Actions Card -->
      <div class="admin-card">
        <h3>‚ö° Quick Actions</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="createTestUser()">Create Test User</button>
          <button class="admin-btn secondary" onclick="clearAllData()">Clear All Data</button>
          <button class="admin-btn tertiary" onclick="backupData()">Backup Data</button>
          <button class="admin-btn" onclick="restoreData()">Restore Data</button>
        </div>
      </div>

      <!-- System Tools Card -->
      <div class="admin-card">
        <h3>üîß System Tools</h3>
        <div class="admin-buttons">
          <a href="test-redirect.html" class="admin-btn">Test Redirect</a>
          <button class="admin-btn secondary" onclick="checkSystem()">System Check</button>
          <button class="admin-btn tertiary" onclick="generateReport()">Generate Report</button>
        </div>
      </div>

      <!-- App Pages Card -->
      <div class="admin-card">
        <h3>üéØ All App Pages</h3>
        <div class="admin-buttons">
          <a href="login-page.html" class="admin-btn">Login Page</a>
          <a href="registration.html" class="admin-btn secondary">Registration Page</a>
          <a href="jobs.html" class="admin-btn tertiary">Jobs Page</a>
          <a href="withdraw.html" class="admin-btn">Withdraw Page</a>
        </div>
      </div>

      <!-- Settings Card -->
      <div class="admin-card">
        <h3>‚öôÔ∏è Settings</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="updateSettings()">App Settings</button>
          <button class="admin-btn secondary" onclick="manageNotifications()">Notifications</button>
          <button class="admin-btn tertiary" onclick="securitySettings()">Security</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Include Scripts -->
  <script src="mobile-compatibility.js"></script>
  <script src="client-storage.js"></script>
  <script src="notifications.js"></script>
  <script src="storage-manager.js"></script>
  <script src="demo-mode.js"></script>

  <script>
    const clientStorage = new ClientStorage();
    
    // Load user stats
    document.addEventListener('DOMContentLoaded', function() {
      loadStats();
      
      // Check if user is admin
      const isAdmin = localStorage.getItem('isAdmin') === 'true' || localStorage.getItem('username') === '0776944';
      if (!isAdmin) {
        alert('Access denied! Admin privileges required.');
        window.location.href = 'getcash.html';
        return;
      }
      
      showNotification('üëë Welcome to Admin Dashboard!', 'success');
    });
    
    function loadStats() {
      const users = clientStorage.getAllUsers();
      document.getElementById('totalUsers').textContent = users.length;
    }
    
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('isAdmin');
        localStorage.removeItem('username');
        localStorage.removeItem('userId');
        sessionStorage.clear();
        showNotification('üëã Logged out successfully!', 'info');
        setTimeout(() => {
          window.location.href = 'login-page.html';
        }, 1500);
      }
    }
    
    function createTestUser() {
      const testUser = {
        username: 'testuser' + Date.now(),
        password: 'test123',
        phone: '123456789'
      };
      
      clientStorage.register(testUser).then(result => {
        if (result.success) {
          showNotification('‚úÖ Test user created: ' + testUser.username, 'success');
          loadStats();
        } else {
          showNotification('‚ùå Error: ' + result.message, 'error');
        }
      });
    }
    
    function clearAllData() {
      if (confirm('‚ö†Ô∏è This will delete ALL user data! Are you sure?')) {
        localStorage.removeItem('getcash_data');
        clientStorage.init();
        showNotification('üóëÔ∏è All data cleared!', 'warning');
        loadStats();
      }
    }
    
    function exportUsers() {
      const users = clientStorage.getAllUsers();
      const dataStr = JSON.stringify(users, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-users-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      showNotification('üìÅ User data exported!', 'success');
    }
    
    function backupData() {
      const allData = clientStorage.getData();
      const dataStr = JSON.stringify(allData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-backup-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      showNotification('üíæ Full backup created!', 'success');
    }
    
    function restoreData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            clientStorage.saveData(data);
            showNotification('üîÑ Data restored successfully!', 'success');
            loadStats();
          } catch (error) {
            showNotification('‚ùå Invalid backup file!', 'error');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    function checkSystem() {
      const checks = [
        'Client Storage: ' + (typeof ClientStorage !== 'undefined' ? '‚úÖ' : '‚ùå'),
        'Notifications: ' + (typeof showNotification === 'function' ? '‚úÖ' : '‚ùå'),
        'Mobile Support: ' + (typeof window.universalRedirect === 'function' ? '‚úÖ' : '‚ùå'),
        'Local Storage: ' + (localStorage.getItem('getcash_data') ? '‚úÖ' : '‚ùå')
      ];
      
      alert('System Status:\n\n' + checks.join('\n'));
    }
    
    function generateReport() {
      const users = clientStorage.getAllUsers();
      const report = {
        generated: new Date().toISOString(),
        totalUsers: users.length,
        adminUsers: users.filter(u => {
          const data = clientStorage.getData();
          const fullUser = data.users.find(fu => fu.id === u.id);
          return fullUser && (fullUser.isAdmin || fullUser.username === '0776944');
        }).length,
        totalBalance: users.reduce((sum, u) => sum + u.balance, 0),
        recentUsers: users.filter(u => {
          const joinDate = new Date(u.joinDate);
          const weekAgo = new Date();
          weekAgo.setDate(weekAgo.getDate() - 7);
          return joinDate > weekAgo;
        }).length
      };
      
      const reportStr = `GetCash Admin Report
Generated: ${report.generated}

üìä Statistics:
- Total Users: ${report.totalUsers}
- Admin Users: ${report.adminUsers}
- Total Balance: $${report.totalBalance}
- New Users (7 days): ${report.recentUsers}
`;
      
      const dataBlob = new Blob([reportStr], {type: 'text/plain'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-report-' + new Date().toISOString().split('T')[0] + '.txt';
      link.click();
      
      showNotification('üìà Report generated!', 'success');
    }
    
    function updateSettings() {
      showNotification('‚öôÔ∏è Settings feature coming soon!', 'info');
    }
    
    function manageNotifications() {
      showNotification('üîî Notification management coming soon!', 'info');
    }
    
    function securitySettings() {
      showNotification('üîí Security settings coming soon!', 'info');
    }
  </script>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-icon" onclick="location.href='getcash.html'">
      <img src="image/icon/index.png" alt="Home">
      <span>Home</span>
    </div>
    <div class="footer-icon footer-active">
      <img src="image/icon/user.png" alt="Admin">
      <span>Admin</span>
    </div>
    <div class="footer-icon" onclick="location.href='admin-users.html'">
      <img src="image/icon/grab.png" alt="Users">
      <span>Users</span>
    </div>
    <div class="footer-icon" onclick="logout()">
      <img src="image/icon/profit.png" alt="Logout">
      <span>Logout</span>
    </div>
  </footer>
</body>
</html>

<!-- Old content removed, replaced with comprehensive admin dashboard -->
      max-width: 120px;
      max-height: 120px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .success-message {
      color: #28a745;
      font-weight: bold;
      text-align: center;
      margin-top: 12px;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease-in-out;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification.success {
      background: #28a745;
    }
    .notification.error {
      background: #dc3545;
    }
    .notification.warning {
      background: #ffc107;
      color: #212529;
    }
    .notification.info {
      background: #17a2b8;
    }
    .notification-close {
      float: right;
      margin-left: 12px;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }
    .confirm-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .confirm-dialog-content {
      background: white;
      padding: 24px;
      border-radius: 12px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .confirm-dialog-buttons {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .confirm-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .confirm-btn.primary {
      background: #dc3545;
      color: white;
    }
    .confirm-btn.secondary {
      background: #6c757d;
      color: white;
    }
    
    /* Navigation Panel Styles */
    .admin-nav-panel {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    .nav-section {
      margin-bottom: 16px;
    }
    .nav-section h4 {
      margin: 0 0 12px 0;
      color: #495057;
      font-size: 14px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .nav-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      min-width: 120px;
    }
    .nav-btn.admin {
      background: #dc3545;
      color: white;
    }
    .nav-btn.admin:hover {
      background: #c82333;
    }
    .nav-btn.user {
      background: #007bff;
      color: white;
    }
    .nav-btn.user:hover {
      background: #0056b3;
    }
    .nav-btn.system {
      background: #28a745;
      color: white;
    }
    .nav-btn.system:hover {
      background: #218838;
    }
    .nav-btn.test {
      background: #ffc107;
      color: #212529;
    }
    .nav-btn.test:hover {
      background: #e0a800;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h2>Admin Dashboard - Upload New Task</h2>
    
    <!-- Quick Navigation Panel -->
    <div class="admin-nav-panel">
      <div class="nav-section">
        <h4>üìã Admin Pages</h4>
        <div class="nav-buttons">
          <button class="nav-btn admin" onclick="window.location.href='admin-view-tasks.html'">View Tasks</button>
          <button class="nav-btn admin" onclick="window.location.href='admin-tasks.html'">Upload Tasks</button>
          <button class="nav-btn admin" onclick="window.location.href='admin-users.html'">User Dashboard</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>üë• User Pages</h4>
        <div class="nav-buttons">
          <button class="nav-btn user" onclick="window.location.href='index.html'">Home</button>
          <button class="nav-btn user" onclick="window.location.href='login-page.html'">Login</button>
          <button class="nav-btn user" onclick="window.location.href='registration.html'">Register</button>
          <button class="nav-btn user" onclick="window.location.href='task-page.html'">Task Page</button>
          <button class="nav-btn user" onclick="window.location.href='task-list.html'">Task List</button>
          <button class="nav-btn user" onclick="window.location.href='jobs.html'">Jobs</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>üí∞ Wallet & Money</h4>
        <div class="nav-buttons">
          <button class="nav-btn system" onclick="window.location.href='wallet-interface.html'">Wallet</button>
          <button class="nav-btn system" onclick="window.location.href='withdraw.html'">Withdraw</button>
          <button class="nav-btn system" onclick="window.location.href='recharge.html'">Recharge</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>üîß System & Testing</h4>
        <div class="nav-buttons">
          <button class="nav-btn test" onclick="window.location.href='test-earnings.html'">Test Earnings</button>
          <button class="nav-btn test" onclick="openInNewTab('http://localhost:3300/api/user/data')">API Test</button>
          <button class="nav-btn test" onclick="showSystemInfo()">System Info</button>
        </div>
      </div>
    </div>
    <form class="admin-form" id="adminTaskForm">
      <label for="taskTitle">Task Title</label>
      <input type="text" id="taskTitle" name="taskTitle" required>
      <label for="taskPrice">Price (UGX)</label>
      <input type="number" id="taskPrice" name="taskPrice" min="0" required>
      <label for="taskImage">Task Image</label>
      <input type="file" id="taskImage" name="taskImage" accept="image/*" required>
      <button type="submit">Upload Task</button>
    </form>
    <div class="task-preview" id="taskPreview" style="display:none;"></div>
    <div class="success-message" id="successMessage" style="display:none;">Task uploaded successfully!</div>
    
    <!-- Quick Admin Actions -->
    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
      <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #495057;">Quick Actions</h4>
      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        <button onclick="clearAllTasks()" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Clear All Tasks</button>
        <button onclick="checkDatabaseStatus()" style="padding:8px 16px;background:#28a745;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Check Database</button>
        <button onclick="window.location.reload()" style="padding:8px 16px;background:#6c757d;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Refresh Page</button>
        <button onclick="showSystemInfo()" style="padding:8px 16px;background:#17a2b8;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">System Info</button>
      </div>
      <div style="margin-top: 12px; padding: 8px; background: #e9ecef; border-radius: 4px; font-size: 11px; color: #6c757d;">
        üí° <strong>Quick Tips:</strong> F5 to refresh ‚Ä¢ Ctrl+Shift+I for DevTools ‚Ä¢ Right-click buttons for context menu
      </div>
    </div>
  </div>
  
  <!-- Notification Container -->
  <div id="notificationContainer"></div>
  
  <!-- Confirmation Dialog -->
  <div id="confirmDialog" class="confirm-dialog" style="display:none;">
    <div class="confirm-dialog-content">
      <h3 id="confirmTitle">Confirm Action</h3>
      <p id="confirmMessage">Are you sure?</p>
      <div class="confirm-dialog-buttons">
        <button class="confirm-btn primary" id="confirmYes">Yes</button>
        <button class="confirm-btn secondary" id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>

<script src="notifications.js"></script>
<script src="storage-manager.js"></script>
<script>
// Use shared notification system from notifications.js

// Navigation helper functions
function openInNewTab(url) {
  window.open(url, '_blank');
}

async function showSystemInfo() {
  try {
    // Check server connectivity
    showNotification('Checking system status...', 'info', 1000);
    
    const serverStatus = await fetch('http://localhost:3300/api/user/data', {
      method: 'HEAD',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'test'}`
      }
    }).then(res => res.ok ? 'Online' : 'Error').catch(() => 'Offline');
    
    const info = {
      'Current URL': window.location.href,
      'Server Status': serverStatus,
      'Server': 'localhost:3300',
      'Database': storageManager.useDatabase ? 'Enabled' : 'localStorage Only',
      'Local Storage Items': Object.keys(localStorage).length,
      'Auth Token': localStorage.getItem('authToken') ? 'Present' : 'Missing',
      'Username': localStorage.getItem('username') || 'Not set',
      'Screen Size': `${window.screen.width}x${window.screen.height}`,
      'Current Time': new Date().toLocaleString()
    };
    
    let infoText = 'System Information:\n\n';
    for (const [key, value] of Object.entries(info)) {
      infoText += `${key}: ${value}\n`;
    }
    
    showNotification(infoText, serverStatus === 'Online' ? 'success' : 'warning', 10000);
  } catch (error) {
    showNotification(`System check failed: ${error.message}`, 'error');
  }
}

async function checkDatabaseStatus() {
  try {
    showNotification('Checking database connection...', 'info', 1000);
    const tasks = await storageManager.getTasks();
    const taskCount = Array.isArray(tasks) ? tasks.length : 0;
    showNotification(`Database connection: OK\nTasks in database: ${taskCount}`, 'success', 4000);
  } catch (error) {
    showNotification(`Database check failed: ${error.message}`, 'error');
  }
}

// Clear all tasks function - now uses database
async function clearAllTasks() {
  const confirmed = await showConfirmDialog(
    'Clear All Tasks',
    'Are you sure you want to delete all tasks? This action cannot be undone.'
  );
  
  if (confirmed) {
    try {
      showNotification('Clearing all tasks...', 'info', 2000);
      await storageManager.clearAllTasks();
      showNotification('All tasks have been cleared!', 'success');
    } catch (error) {
      showNotification('Failed to clear tasks: ' + error.message, 'error');
    }
  }
}
</script>
  <script>
    // Preview image
    document.getElementById('taskImage').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('taskPreview');
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          preview.innerHTML = `<img src="${evt.target.result}" alt="Preview"><div>${document.getElementById('taskTitle').value}</div><div>UGX ${document.getElementById('taskPrice').value}</div>`;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = '';
        preview.style.display = 'none';
      }
    });

    // Save to database (with localStorage fallback)
    document.getElementById('adminTaskForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const title = document.getElementById('taskTitle').value;
      const price = document.getElementById('taskPrice').value;
      const imageInput = document.getElementById('taskImage');
      const file = imageInput.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = async function(evt) {
        try {
          showNotification('Uploading task...', 'info', 2000);
          await storageManager.createTask(title, price, evt.target.result);
          showNotification(`Task "${title}" uploaded successfully to database!`, 'success');
          document.getElementById('adminTaskForm').reset();
          document.getElementById('taskPreview').style.display = 'none';
        } catch (error) {
          showNotification('Failed to upload task: ' + error.message, 'error');
        }
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
