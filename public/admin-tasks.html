<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Upload Tasks</title>
  <link rel="stylesheet" href="getcash.css">
  <style>
    .admin-container {
      max-width: 500px;
      margin: 40px auto 100px auto;
      padding: 24px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    }
    .admin-container h2 {
      text-align: center;
      margin-bottom: 24px;
    }
    .admin-form label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .admin-form input, .admin-form textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
    }
    .admin-form button {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 24px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
    }
    .admin-form button:active {
      background: #0056b3;
    }
    .task-preview {
      margin-top: 20px;
      text-align: center;
    }
    .task-preview img {
      max-width: 120px;
      max-height: 120px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .success-message {
      color: #28a745;
      font-weight: bold;
      text-align: center;
      margin-top: 12px;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease-in-out;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification.success {
      background: #28a745;
    }
    .notification.error {
      background: #dc3545;
    }
    .notification.warning {
      background: #ffc107;
      color: #212529;
    }
    .notification.info {
      background: #17a2b8;
    }
    .notification-close {
      float: right;
      margin-left: 12px;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }
    .confirm-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .confirm-dialog-content {
      background: white;
      padding: 24px;
      border-radius: 12px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .confirm-dialog-buttons {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .confirm-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .confirm-btn.primary {
      background: #dc3545;
      color: white;
    }
    .confirm-btn.secondary {
      background: #6c757d;
      color: white;
    }
    
    /* Navigation Panel Styles */
    .admin-nav-panel {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    .nav-section {
      margin-bottom: 16px;
    }
    .nav-section h4 {
      margin: 0 0 12px 0;
      color: #495057;
      font-size: 14px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .nav-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      min-width: 120px;
    }
    .nav-btn.admin {
      background: #dc3545;
      color: white;
    }
    .nav-btn.admin:hover {
      background: #c82333;
    }
    .nav-btn.user {
      background: #007bff;
      color: white;
    }
    .nav-btn.user:hover {
      background: #0056b3;
    }
    .nav-btn.system {
      background: #28a745;
      color: white;
    }
    .nav-btn.system:hover {
      background: #218838;
    }
    .nav-btn.test {
      background: #ffc107;
      color: #212529;
    }
    .nav-btn.test:hover {
      background: #e0a800;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h2>Admin Dashboard - Upload New Task</h2>
    
    <!-- Quick Navigation Panel -->
    <div class="admin-nav-panel">
      <div class="nav-section">
        <h4>ðŸ“‹ Admin Pages</h4>
        <div class="nav-buttons">
          <button class="nav-btn admin" onclick="window.location.href='admin-view-tasks.html'">View Tasks</button>
          <button class="nav-btn admin" onclick="window.location.href='admin-tasks.html'">Upload Tasks</button>
          <button class="nav-btn admin" onclick="window.location.href='admin-users.html'">User Dashboard</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>ðŸ‘¥ User Pages</h4>
        <div class="nav-buttons">
          <button class="nav-btn user" onclick="window.location.href='index.html'">Home</button>
          <button class="nav-btn user" onclick="window.location.href='login-page.html'">Login</button>
          <button class="nav-btn user" onclick="window.location.href='registration.html'">Register</button>
          <button class="nav-btn user" onclick="window.location.href='task-page.html'">Task Page</button>
          <button class="nav-btn user" onclick="window.location.href='task-list.html'">Task List</button>
          <button class="nav-btn user" onclick="window.location.href='jobs.html'">Jobs</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>ðŸ’° Wallet & Money</h4>
        <div class="nav-buttons">
          <button class="nav-btn system" onclick="window.location.href='wallet-interface.html'">Wallet</button>
          <button class="nav-btn system" onclick="window.location.href='withdraw.html'">Withdraw</button>
          <button class="nav-btn system" onclick="window.location.href='recharge.html'">Recharge</button>
        </div>
      </div>
      
      <div class="nav-section">
        <h4>ðŸ”§ System & Testing</h4>
        <div class="nav-buttons">
          <button class="nav-btn test" onclick="window.location.href='test-earnings.html'">Test Earnings</button>
          <button class="nav-btn test" onclick="openInNewTab('http://localhost:3300/api/user/data')">API Test</button>
          <button class="nav-btn test" onclick="showSystemInfo()">System Info</button>
        </div>
      </div>
    </div>
    <form class="admin-form" id="adminTaskForm">
      <label for="taskTitle">Task Title</label>
      <input type="text" id="taskTitle" name="taskTitle" required>
      <label for="taskPrice">Price (UGX)</label>
      <input type="number" id="taskPrice" name="taskPrice" min="0" required>
      <label for="taskImage">Task Image</label>
      <input type="file" id="taskImage" name="taskImage" accept="image/*" required>
      <button type="submit">Upload Task</button>
    </form>
    <div class="task-preview" id="taskPreview" style="display:none;"></div>
    <div class="success-message" id="successMessage" style="display:none;">Task uploaded successfully!</div>
    
    <!-- Quick Admin Actions -->
    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #dee2e6;">
      <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #495057;">Quick Actions</h4>
      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        <button onclick="clearAllTasks()" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Clear All Tasks</button>
        <button onclick="checkDatabaseStatus()" style="padding:8px 16px;background:#28a745;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Check Database</button>
        <button onclick="window.location.reload()" style="padding:8px 16px;background:#6c757d;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">Refresh Page</button>
        <button onclick="showSystemInfo()" style="padding:8px 16px;background:#17a2b8;color:#fff;border:none;border-radius:5px;font-size:13px;cursor:pointer;flex: 1; min-width: 110px;">System Info</button>
      </div>
      <div style="margin-top: 12px; padding: 8px; background: #e9ecef; border-radius: 4px; font-size: 11px; color: #6c757d;">
        ðŸ’¡ <strong>Quick Tips:</strong> F5 to refresh â€¢ Ctrl+Shift+I for DevTools â€¢ Right-click buttons for context menu
      </div>
    </div>
  </div>
  
  <!-- Notification Container -->
  <div id="notificationContainer"></div>
  
  <!-- Confirmation Dialog -->
  <div id="confirmDialog" class="confirm-dialog" style="display:none;">
    <div class="confirm-dialog-content">
      <h3 id="confirmTitle">Confirm Action</h3>
      <p id="confirmMessage">Are you sure?</p>
      <div class="confirm-dialog-buttons">
        <button class="confirm-btn primary" id="confirmYes">Yes</button>
        <button class="confirm-btn secondary" id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>

<script src="notifications.js"></script>
<script src="storage-manager.js"></script>
<script>
// Use shared notification system from notifications.js

// Navigation helper functions
function openInNewTab(url) {
  window.open(url, '_blank');
}

async function showSystemInfo() {
  try {
    // Check server connectivity
    showNotification('Checking system status...', 'info', 1000);
    
    const serverStatus = await fetch('http://localhost:3300/api/user/data', {
      method: 'HEAD',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('authToken') || 'test'}`
      }
    }).then(res => res.ok ? 'Online' : 'Error').catch(() => 'Offline');
    
    const info = {
      'Current URL': window.location.href,
      'Server Status': serverStatus,
      'Server': 'localhost:3300',
      'Database': storageManager.useDatabase ? 'Enabled' : 'localStorage Only',
      'Local Storage Items': Object.keys(localStorage).length,
      'Auth Token': localStorage.getItem('authToken') ? 'Present' : 'Missing',
      'Username': localStorage.getItem('username') || 'Not set',
      'Screen Size': `${window.screen.width}x${window.screen.height}`,
      'Current Time': new Date().toLocaleString()
    };
    
    let infoText = 'System Information:\n\n';
    for (const [key, value] of Object.entries(info)) {
      infoText += `${key}: ${value}\n`;
    }
    
    showNotification(infoText, serverStatus === 'Online' ? 'success' : 'warning', 10000);
  } catch (error) {
    showNotification(`System check failed: ${error.message}`, 'error');
  }
}

async function checkDatabaseStatus() {
  try {
    showNotification('Checking database connection...', 'info', 1000);
    const tasks = await storageManager.getTasks();
    const taskCount = Array.isArray(tasks) ? tasks.length : 0;
    showNotification(`Database connection: OK\nTasks in database: ${taskCount}`, 'success', 4000);
  } catch (error) {
    showNotification(`Database check failed: ${error.message}`, 'error');
  }
}

// Clear all tasks function - now uses database
async function clearAllTasks() {
  const confirmed = await showConfirmDialog(
    'Clear All Tasks',
    'Are you sure you want to delete all tasks? This action cannot be undone.'
  );
  
  if (confirmed) {
    try {
      showNotification('Clearing all tasks...', 'info', 2000);
      await storageManager.clearAllTasks();
      showNotification('All tasks have been cleared!', 'success');
    } catch (error) {
      showNotification('Failed to clear tasks: ' + error.message, 'error');
    }
  }
}
</script>
  <script>
    // Preview image
    document.getElementById('taskImage').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('taskPreview');
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          preview.innerHTML = `<img src="${evt.target.result}" alt="Preview"><div>${document.getElementById('taskTitle').value}</div><div>UGX ${document.getElementById('taskPrice').value}</div>`;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = '';
        preview.style.display = 'none';
      }
    });

    // Save to database (with localStorage fallback)
    document.getElementById('adminTaskForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const title = document.getElementById('taskTitle').value;
      const price = document.getElementById('taskPrice').value;
      const imageInput = document.getElementById('taskImage');
      const file = imageInput.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = async function(evt) {
        try {
          showNotification('Uploading task...', 'info', 2000);
          await storageManager.createTask(title, price, evt.target.result);
          showNotification(`Task "${title}" uploaded successfully to database!`, 'success');
          document.getElementById('adminTaskForm').reset();
          document.getElementById('taskPreview').style.display = 'none';
        } catch (error) {
          showNotification('Failed to upload task: ' + error.message, 'error');
        }
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
