<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  <title>👑 Admin Dashboard - GetCash</title>
  <link rel="stylesheet" href="getcash.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .admin-header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 100px;
    }
    
    .admin-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .admin-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }
    
    .admin-card h3 {
      color: white;
      font-size: 1.5em;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .admin-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .admin-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }
    
    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
    }
    
    .admin-btn.secondary {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
    }
    
    .admin-btn.secondary:hover {
      box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
    }
    
    .admin-btn.tertiary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .admin-btn.tertiary:hover {
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .stats-card {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      color: white;
      text-align: center;
    }
    
    .stats-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    
    @media (max-width: 768px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-header h1 {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">🚪 Logout</button>
  
  <div class="admin-header">
    <h1>👑 Admin Dashboard</h1>
    <p>Welcome, Admin! Manage your GetCash platform</p>
  </div>

  <div class="admin-container">
    <!-- Stats Overview -->
    <div class="stats-card">
      <div class="stats-number" id="totalUsers">0</div>
      <div>Total Users</div>
    </div>

    <div class="admin-grid">
      <!-- User Management Card -->
      <div class="admin-card">
        <h3>👥 User Management</h3>
        <div class="admin-buttons">
          <a href="admin-users.html" class="admin-btn">View All Users</a>
          <a href="admin-setup.html" class="admin-btn secondary">Admin Setup</a>
          <button class="admin-btn tertiary" onclick="exportUsers()">Export User Data</button>
        </div>
      </div>

      <!-- Task Management Card -->
      <div class="admin-card">
        <h3>📋 Task Management</h3>
        <div class="admin-buttons">
          <a href="task-upload.html" class="admin-btn">📤 Upload New Task</a>
          <a href="task-list.html" class="admin-btn secondary">👀 View All Tasks</a>
          <button class="admin-btn tertiary" onclick="viewUploadedTasks()">📊 Manage Tasks</button>
        </div>
      </div>

      <!-- Page Navigation Card -->
      <div class="admin-card">
        <h3>📄 Page Management</h3>
        <div class="admin-buttons">
          <a href="getcash.html" class="admin-btn">Main GetCash Page</a>
          <a href="task-list.html" class="admin-btn secondary">Task List</a>
          <a href="wallet-interface.html" class="admin-btn tertiary">Wallet Interface</a>
          <a href="recharge.html" class="admin-btn">Recharge Page</a>
        </div>
      </div>

      <!-- Quick Actions Card -->
      <div class="admin-card">
        <h3>⚡ Quick Actions</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="createTestUser()">Create Test User</button>
          <button class="admin-btn secondary" onclick="clearAllData()">Clear All Data</button>
          <button class="admin-btn tertiary" onclick="backupData()">Backup Data</button>
          <button class="admin-btn" onclick="restoreData()">Restore Data</button>
        </div>
      </div>

      <!-- System Tools Card -->
      <div class="admin-card">
        <h3>🔧 System Tools</h3>
        <div class="admin-buttons">
          <a href="test-redirect.html" class="admin-btn">Test Redirect</a>
          <button class="admin-btn secondary" onclick="checkSystem()">System Check</button>
          <button class="admin-btn tertiary" onclick="generateReport()">Generate Report</button>
        </div>
      </div>

      <!-- App Pages Card -->
      <div class="admin-card">
        <h3>🎯 All App Pages</h3>
        <div class="admin-buttons">
          <a href="login-page.html" class="admin-btn">Login Page</a>
          <a href="registration.html" class="admin-btn secondary">Registration Page</a>
          <a href="jobs.html" class="admin-btn tertiary">Jobs Page</a>
          <a href="withdraw.html" class="admin-btn">Withdraw Page</a>
        </div>
      </div>

      <!-- Job System Management Card -->
      <div class="admin-card">
        <h3>🚀 Job System</h3>
        <div class="admin-buttons">
          <a href="admin-approvals.html" class="admin-btn">📋 View Approvals</a>
          <a href="admin-wallet.html" class="admin-btn secondary">💰 Wallet Management</a>
          <a href="jobs.html" class="admin-btn tertiary">🎯 Jobs Page</a>
        </div>
      </div>

      <!-- Testing & Workflow Card -->
      <div class="admin-card">
        <h3>🧪 System Testing</h3>
        <div class="admin-buttons">
          <a href="test-workflow.html" class="admin-btn">🧪 Test Full Workflow</a>
          <a href="add-sample-tasks.html" class="admin-btn secondary">🎯 Sample Tasks</a>
          <button class="admin-btn tertiary" onclick="resetTestEnvironment()">🔄 Reset Test Data</button>
        </div>
      </div>

      <!-- Settings Card -->
      <div class="admin-card">
        <h3>⚙️ Settings</h3>
        <div class="admin-buttons">
          <button class="admin-btn" onclick="updateSettings()">App Settings</button>
          <button class="admin-btn secondary" onclick="manageNotifications()">Notifications</button>
          <button class="admin-btn tertiary" onclick="securitySettings()">Security</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Include Scripts -->
  <script src="mobile-compatibility.js"></script>
  <script src="client-storage.js"></script>
  <script src="notifications.js"></script>
  <script src="storage-manager.js"></script>
  <script src="demo-mode.js"></script>

  <script>
    const clientStorage = new ClientStorage();
    
    // Load user stats
    document.addEventListener('DOMContentLoaded', function() {
      loadStats();
      
      // Check if user is admin
      const isAdmin = localStorage.getItem('isAdmin') === 'true' || localStorage.getItem('username') === '0776944';
      if (!isAdmin) {
        alert('Access denied! Admin privileges required.');
        window.location.href = 'getcash.html';
        return;
      }
      
      if (typeof showNotification === 'function') {
        showNotification('👑 Welcome to Admin Dashboard!', 'success');
      }
    });
    
    function loadStats() {
      try {
        const users = clientStorage.getAllUsers();
        document.getElementById('totalUsers').textContent = users.length;
      } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('totalUsers').textContent = '0';
      }
    }
    
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('isAdmin');
        localStorage.removeItem('username');
        localStorage.removeItem('userId');
        sessionStorage.clear();
        if (typeof showNotification === 'function') {
          showNotification('👋 Logged out successfully!', 'info');
        }
        setTimeout(() => {
          window.location.href = 'login-page.html';
        }, 1500);
      }
    }
    
    function createTestUser() {
      const testUser = {
        username: 'testuser' + Date.now(),
        password: 'test123',
        phone: '123456789'
      };
      
      clientStorage.register(testUser).then(result => {
        if (result.success) {
          if (typeof showNotification === 'function') {
            showNotification('✅ Test user created: ' + testUser.username, 'success');
          }
          loadStats();
        } else {
          if (typeof showNotification === 'function') {
            showNotification('❌ Error: ' + result.message, 'error');
          }
        }
      });
    }
    
    function clearAllData() {
      if (confirm('⚠️ This will delete ALL user data! Are you sure?')) {
        localStorage.removeItem('getcash_data');
        clientStorage.init();
        if (typeof showNotification === 'function') {
          showNotification('🗑️ All data cleared!', 'warning');
        }
        loadStats();
      }
    }
    
    function exportUsers() {
      const users = clientStorage.getAllUsers();
      const dataStr = JSON.stringify(users, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-users-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      if (typeof showNotification === 'function') {
        showNotification('📁 User data exported!', 'success');
      }
    }
    
    function backupData() {
      const allData = clientStorage.getData();
      const dataStr = JSON.stringify(allData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-backup-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      if (typeof showNotification === 'function') {
        showNotification('💾 Full backup created!', 'success');
      }
    }
    
    function restoreData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            clientStorage.saveData(data);
            if (typeof showNotification === 'function') {
              showNotification('🔄 Data restored successfully!', 'success');
            }
            loadStats();
          } catch (error) {
            if (typeof showNotification === 'function') {
              showNotification('❌ Invalid backup file!', 'error');
            }
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    function checkSystem() {
      const checks = [
        'Client Storage: ' + (typeof ClientStorage !== 'undefined' ? '✅' : '❌'),
        'Notifications: ' + (typeof showNotification === 'function' ? '✅' : '❌'),
        'Mobile Support: ' + (typeof window.universalRedirect === 'function' ? '✅' : '❌'),
        'Local Storage: ' + (localStorage.getItem('getcash_data') ? '✅' : '❌')
      ];
      
      alert('System Status:\n\n' + checks.join('\n'));
    }
    
    function generateReport() {
      const users = clientStorage.getAllUsers();
      const report = {
        generated: new Date().toISOString(),
        totalUsers: users.length,
        adminUsers: users.filter(u => {
          const data = clientStorage.getData();
          const fullUser = data.users.find(fu => fu.id === u.id);
          return fullUser && (fullUser.isAdmin || fullUser.username === '0776944');
        }).length,
        totalBalance: users.reduce((sum, u) => sum + u.balance, 0),
        recentUsers: users.filter(u => {
          const joinDate = new Date(u.joinDate);
          const weekAgo = new Date();
          weekAgo.setDate(weekAgo.getDate() - 7);
          return joinDate > weekAgo;
        }).length
      };
      
      const reportStr = `GetCash Admin Report
Generated: ${report.generated}

📊 Statistics:
- Total Users: ${report.totalUsers}
- Admin Users: ${report.adminUsers}
- Total Balance: $${report.totalBalance}
- New Users (7 days): ${report.recentUsers}
`;
      
      const dataBlob = new Blob([reportStr], {type: 'text/plain'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'getcash-report-' + new Date().toISOString().split('T')[0] + '.txt';
      link.click();
      
      if (typeof showNotification === 'function') {
        showNotification('📈 Report generated!', 'success');
      }
    }
    
    function updateSettings() {
      if (typeof showNotification === 'function') {
        showNotification('⚙️ Settings feature coming soon!', 'info');
      }
    }
    
    function manageNotifications() {
      if (typeof showNotification === 'function') {
        showNotification('🔔 Notification management coming soon!', 'info');
      }
    }
    
    function securitySettings() {
      if (typeof showNotification === 'function') {
        showNotification('🔒 Security settings coming soon!', 'info');
      }
    }

    function resetTestEnvironment() {
      if (confirm('⚠️ Reset test environment? This will:\n\n• Reset all users to intern level\n• Clear completed tasks\n• Clear pending approvals\n• Reset wallet balances\n\nContinue?')) {
        try {
          // Get all usernames from localStorage
          const usernames = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('jobData_')) {
              const username = key.replace('jobData_', '');
              usernames.push(username);
            }
          }

          // Reset each user's data
          usernames.forEach(username => {
            // Reset job data
            const resetJobData = {
              currentLevel: 'intern',
              levelStartDate: new Date().toISOString(),
              tasksCompleted: 0,
              totalEarnings: 0,
              upgradeHistory: []
            };
            localStorage.setItem(`jobData_${username}`, JSON.stringify(resetJobData));

            // Reset wallets
            localStorage.removeItem(`incomeWallet_${username}`);
            localStorage.removeItem(`personalWallet_${username}`);
            localStorage.removeItem(`walletTransactions_${username}`);
          });

          // Clear global data
          localStorage.setItem('completedTasks', JSON.stringify([]));
          localStorage.setItem('adminApprovals', JSON.stringify([]));

          if (typeof showNotification === 'function') {
            showNotification('✅ Test environment reset successfully! All users are now interns with clean data.', 'success', 5000);
          } else {
            alert('✅ Test environment reset successfully!');
          }
        } catch (error) {
          console.error('Error resetting test environment:', error);
          if (typeof showNotification === 'function') {
            showNotification('❌ Error resetting test environment: ' + error.message, 'error');
          } else {
            alert('❌ Error resetting test environment: ' + error.message);
          }
        }
      }
    }
    
    function viewUploadedTasks() {
      const tasks = JSON.parse(localStorage.getItem('adminTasks') || '[]');
      
      if (tasks.length === 0) {
        if (typeof showNotification === 'function') {
          showNotification('📭 No tasks uploaded yet. Use "Upload New Task" to create your first task!', 'info');
        } else {
          alert('No tasks uploaded yet. Use "Upload New Task" to create your first task!');
        }
        return;
      }
      
      const taskList = tasks.map((task, index) => 
        `${index + 1}. ${task.title} - UGX ${task.price.toLocaleString()}`
      ).join('\n');
      
      const message = `📋 Uploaded Tasks (${tasks.length}):\n\n${taskList}\n\n💡 Users can see these tasks in the Task List page.`;
      
      if (typeof showNotification === 'function') {
        showNotification(message, 'info', 8000);
      } else {
        alert(message);
      }
    }
  </script>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-icon" onclick="location.href='getcash.html'">
      <img src="image/icon/index.png" alt="Home">
      <span>Home</span>
    </div>
    <div class="footer-icon footer-active">
      <img src="image/icon/user.png" alt="Admin">
      <span>Admin</span>
    </div>
    <div class="footer-icon" onclick="location.href='admin-users.html'">
      <img src="image/icon/grab.png" alt="Users">
      <span>Users</span>
    </div>
    <div class="footer-icon" onclick="logout()">
      <img src="image/icon/profit.png" alt="Logout">
      <span>Logout</span>
    </div>
  </footer>
</body>
</html>